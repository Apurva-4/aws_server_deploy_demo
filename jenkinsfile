pipeline {
  agent any
  stages {
    stage('Clone repository') {
      steps {
        sh"whoami"
        git 'https://github.com/Apurva-4/aws_server_deploy_demo.git'
      }
    }
    stage('Deploy to Kubernetes') {
      steps {
        script {
          sshagent(['sshagent']) {
          sh "ssh apurva@192.168.0.103"
          sh " whoami"
          def pod_name = sh(returnStdout: true, script: 'kubectl get pods httpd-deployment-859c98485f-rx6ml -n frontend')
          sh "kubectl cp aws_server_deploy_demo/demo.html $pod_name:/usr/local/apache2/htdocs"
          sh "kubectl restart pod $pod_name"
        }
      }
      }
    }
  }
}