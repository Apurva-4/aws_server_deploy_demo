pipeline {
  agent any
  stages {
    stage('Clone repository') {
      steps {
        git 'https://github.com/Apurva-4/aws_server_deploy_demo.git'
      }
    }
    stage('Deploy to Kubernetes') {
      steps {
        curl -LO https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl
        curl -LO "https://dl.k8s.io/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256"
        sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
        pod_name = kubectl get pods -l app=apache -n frontend
        kubectl cp -r aws_server_deploy_demo/ ./pod_name:/usr/local/apache2/htdocs
        kubectl restart pod_name
      }
    }
  }
}
